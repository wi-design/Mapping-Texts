var STANFORD;if(STANFORD){if(STANFORD.MAPPING_TEXTS)throw Error("STANFORD.MAPPING_TEXTS namepsace already exists! Exception thrown to avoid clobbering it.");}else STANFORD={};
STANFORD.MAPPING_TEXTS={geocoding:{texas:new google.maps.LatLng(31.9686,-99.90181),brazoria:new google.maps.LatLng(29.04441,-95.56911),breckenridge:new google.maps.LatLng(32.75568,-98.90229),matagorda:new google.maps.LatLng(28.69113,-95.96827),columbia:new google.maps.LatLng(32.22777,-98.20895),austin:new google.maps.LatLng(30.26715,-97.74306),houston:new google.maps.LatLng(29.76019,-95.36939),brownsville:new google.maps.LatLng(25.90175,-97.49748),fort_worth:new google.maps.LatLng(32.72541,-97.32085),
galveston:new google.maps.LatLng(29.30135,-94.7977),jefferson:new google.maps.LatLng(32.75736,-94.34519),san_augustine:new google.maps.LatLng(31.5299,-94.10603),la_grange:new google.maps.LatLng(29.9055,-96.87665),port_lavaca:new google.maps.LatLng(28.615,-96.62609),lavaca:new google.maps.LatLng(29.33591,-96.8351),palestine:new google.maps.LatLng(31.76212,-95.63079),richmond:new google.maps.LatLng(29.58218,-95.76078),san_luis:new google.maps.LatLng(29.73459,-98.20343),san_felipe:new google.maps.LatLng(29.79301,
-96.10079),nacogdoches:new google.maps.LatLng(31.60351,-94.65549),washington:new google.maps.LatLng(30.325,-96.15639),victoria:new google.maps.LatLng(28.80527,-97.0036),bartlett:new google.maps.LatLng(30.79491,-97.42556),canadian:new google.maps.LatLng(35.91282,-100.38208),brownwood:new google.maps.LatLng(31.70932,-98.99116),corpus_christi:new google.maps.LatLng(27.80058,-97.39638),san_antonio:new google.maps.LatLng(29.42412,-98.49363),abilene:new google.maps.LatLng(32.44874,-99.73314),clarksville:new google.maps.LatLng(33.61066,
-95.05272),palo_pinto:new google.maps.LatLng(32.76799,-98.29875),huntsville:new google.maps.LatLng(30.72353,-95.55078),tulia:new google.maps.LatLng(34.53589,-101.75852),contour:[[36.5,-103.00029],[33.99972,-103.04167],[32.99944,-103.06583],[31.99972,-103.06652],[31.99972,-106.61722],[31.98743,-106.66223],[31.88611,-106.6286],[31.8268,-106.59333],[31.78076,-106.52288],[31.75027,-106.46001],[31.75403,-106.41654],[31.68735,-106.33431],[31.6375,-106.30335],[31.5593,-106.27223],[31.47222,-106.20987],[31.43194,
-106.14362],[31.4025,-106.06293],[31.39527,-106.01167],[31.36972,-105.97278],[31.26916,-105.84195],[31.20819,-105.78696],[31.08153,-105.60001],[30.99639,-105.5414],[30.94639,-105.49071],[30.86584,-105.39306],[30.79722,-105.25306],[30.77861,-105.16944],[30.74972,-105.125],[30.63222,-104.99084],[30.60764,-104.93473],[30.56624,-104.89653],[30.525,-104.87973],[30.46639,-104.86501],[30.38611,-104.82224],[30.31806,-104.77695],[30.23333,-104.70556],[30.1875,-104.68224],[30.10542,-104.67931],[30.05888,-104.70133],
[30.005,-104.69501],[29.94097,-104.67806],[29.67292,-104.54182],[29.59584,-104.45334],[29.525,-104.33805],[29.52597,-104.28514],[29.49445,-104.22835],[29.42277,-104.16973],[29.3425,-104.06361],[29.32111,-104.02362],[29.30583,-103.97501],[29.28583,-103.88917],[29.19916,-103.73584],[29.12611,-103.5314],[29.07305,-103.46195],[29.03639,-103.40112],[28.99652,-103.29087],[28.98403,-103.16369],[29.09416,-103.05195],[29.18306,-102.955],[29.25416,-102.89585],[29.35222,-102.85112],[29.47408,-102.80476],[29.74277,
-102.67029],[29.78166,-102.49625],[29.85055,-102.35556],[29.88798,-102.30181],[29.84722,-102.22778],[29.80277,-102.0975],[29.79847,-102.0482],[29.80583,-101.99085],[29.80472,-101.82584],[29.79666,-101.77474],[29.77806,-101.70668],[29.76639,-101.62876],[29.77111,-101.53917],[29.77278,-101.40501],[29.66055,-101.35584],[29.61527,-101.31084],[29.54027,-101.21861],[29.49069,-101.13904],[29.43777,-101.02528],[29.35,-100.93695],[29.25875,-100.79571],[29.10903,-100.66584],[28.99583,-100.62821],[28.93333,
-100.62195],[28.86361,-100.56445],[28.82277,-100.52736],[28.72571,-100.49182],[28.67584,-100.47986],[28.62639,-100.44389],[28.51833,-100.35917],[28.40041,-100.33126],[28.28056,-100.28146],[28.1975,-100.1864],[28.15562,-100.07834],[27.96166,-99.93501],[27.90389,-99.88084],[27.80514,-99.86091],[27.77174,-99.8067],[27.71472,-99.7414],[27.66894,-99.7139],[27.64139,-99.65363],[27.64124,-99.60618],[27.56805,-99.5039],[27.47666,-99.4732],[27.25806,-99.44335],[27.04694,-99.45862],[26.86985,-99.31925],[26.83083,
-99.25334],[26.71445,-99.20056],[26.52694,-99.13251],[26.435,-99.10474],[26.40583,-98.97557],[26.34889,-98.78418],[26.28972,-98.69556],[26.25611,-98.57834],[26.22333,-98.43987],[26.19166,-98.38806],[26.15361,-98.36139],[26.09777,-98.28612],[26.0625,-98.20001],[26.04777,-98.03334],[26.05861,-97.97974],[26.06361,-97.84751],[26.03805,-97.6789],[26.005,-97.61446],[25.95111,-97.55945],[25.89833,-97.51445],[25.84333,-97.41723],[25.85966,-97.34474],[25.92,-97.31529],[25.94111,-97.26529],[25.96643,-97.14074],
[26.07014,-97.16788],[26.02771,-97.18066],[25.98194,-97.24077],[26.16138,-97.31751],[26.24611,-97.31862],[26.36944,-97.40195],[26.41195,-97.41278],[26.54555,-97.42305],[26.80701,-97.50403],[26.84208,-97.56041],[27.00548,-97.55742],[27.03083,-97.47501],[27.12805,-97.44445],[27.26229,-97.42936],[27.25777,-97.47695],[27.23527,-97.53389],[27.2525,-97.63389],[27.31698,-97.6767],[27.39554,-97.72333],[27.44972,-97.76934],[27.43222,-97.72333],[27.38555,-97.67694],[27.3448,-97.62469],[27.37722,-97.52528],
[27.30624,-97.49],[27.32729,-97.41299],[27.65611,-97.27973],[27.71555,-97.31555],[27.78334,-97.39277],[27.82583,-97.48472],[27.87806,-97.49249],[27.8525,-97.34527],[27.8218,-97.19451],[28.03166,-97.0225],[28.09166,-97.04611],[28.06972,-97.09806],[28.04,-97.14666],[28.06854,-97.21347],[28.1618,-97.16937],[28.18638,-97.02806],[28.12111,-96.98334],[28.12708,-96.93097],[28.14027,-96.88276],[28.24138,-96.78084],[28.34896,-96.78382],[28.40986,-96.84522],[28.47152,-96.80034],[28.43777,-96.74695],[28.3977,
-96.70708],[28.33409,-96.69701],[28.32416,-96.62471],[28.44173,-96.39997],[28.50944,-96.48999],[28.56694,-96.58389],[28.71194,-96.64473],[28.69756,-96.56256],[28.64777,-96.5552],[28.61944,-96.49555],[28.63548,-96.40867],[28.76027,-96.44291],[28.73619,-96.39411],[28.68514,-96.26736],[28.69548,-96.19208],[28.62729,-96.1408],[28.58195,-96.21743],[28.60208,-96.13361],[28.63445,-96.05915],[28.65104,-95.99068],[28.60388,-95.99652],[28.57388,-96.07236],[28.53833,-96.14666],[28.48812,-96.21201],[28.52195,
-96.1311],[28.59027,-96.00056],[28.62138,-95.89555],[28.64833,-95.82723],[28.69249,-95.76551],[28.66819,-95.84778],[28.64,-95.89612],[28.62632,-95.94152],[28.68642,-95.94111],[28.73694,-95.79723],[28.73814,-95.68989],[28.75556,-95.61833],[28.89611,-95.35973],[28.93153,-95.30319],[29.05124,-95.14861],[29.18194,-95.08695],[29.33777,-94.8939],[29.4209,-94.89799],[29.56556,-95.01584],[29.71506,-95.06006],[29.71652,-95.00709],[29.69583,-94.95555],[29.76195,-94.82431],[29.785,-94.75702],[29.7568,-94.71104],
[29.71111,-94.70666],[29.61291,-94.73042],[29.56805,-94.76584],[29.55277,-94.67556],[29.57319,-94.57403],[29.55888,-94.47659],[29.51653,-94.51542],[29.49444,-94.61221],[29.46749,-94.69208],[29.36791,-94.75417],[29.40944,-94.70806],[29.44708,-94.65361],[29.58416,-94.31751],[29.65361,-94.1343],[29.67916,-94.03639],[29.68163,-93.85844],[29.76556,-93.91472],[29.81666,-93.95847],[29.98514,-93.85201],[29.99416,-93.79666],[30.06597,-93.72292],[30.15138,-93.69846],[30.25111,-93.71501],[30.31083,-93.73916],
[30.37306,-93.75695],[30.5493,-93.73251],[30.64638,-93.67917],[30.68361,-93.63474],[30.83125,-93.56235],[31.07416,-93.53528],[31.18478,-93.53708],[31.23138,-93.60777],[31.36361,-93.66028],[31.545,-93.78889],[31.6025,-93.83229],[31.68514,-93.81931],[31.78569,-93.8375],[31.86374,-93.88736],[31.90506,-93.93034],[31.92346,-93.97014],[31.99592,-94.04253],[32.91638,-94.04334],[33.01093,-94.04149],[33.55332,-94.04527],[33.57361,-94.09042],[33.58971,-94.19138],[33.56266,-94.31569],[33.55583,-94.38416],[33.605,
-94.45167],[33.64716,-94.48419],[33.64916,-94.54361],[33.69249,-94.71417],[33.74944,-94.85278],[33.81722,-94.95223],[33.85416,-94.99777],[33.9454,-95.15389],[33.96221,-95.22753],[33.91173,-95.2589],[33.8875,-95.30499],[33.87027,-95.37055],[33.86666,-95.43306],[33.91465,-95.5441],[33.94332,-95.59264],[33.86776,-95.77028],[33.85583,-95.87471],[33.87055,-95.96112],[33.84096,-96.09847],[33.82132,-96.14847],[33.76361,-96.18777],[33.69999,-96.32049],[33.77944,-96.47278],[33.84944,-96.59473],[33.84471,-96.7282],
[33.86804,-96.84292],[33.90221,-96.87791],[33.95499,-96.9059],[33.94944,-96.97409],[33.84749,-97.04777],[33.75361,-97.08307],[33.73333,-97.16195],[33.78513,-97.19861],[33.83416,-97.195],[33.89194,-97.24222],[33.82111,-97.39681],[33.84152,-97.45514],[33.90221,-97.51306],[33.97083,-97.595],[33.98318,-97.67153],[33.95888,-97.71501],[33.89145,-97.78305],[33.86069,-97.86104],[33.87791,-97.94764],[33.93554,-97.94784],[33.99819,-97.98138],[34.0075,-98.05735],[34.06656,-98.09351],[34.12777,-98.16722],[34.13221,
-98.28277],[34.08215,-98.40903],[34.06985,-98.47875],[34.1036,-98.53431],[34.15152,-98.58203],[34.15263,-98.65903],[34.1375,-98.74055],[34.15471,-98.83528],[34.19805,-99.02445],[34.21541,-99.17485],[34.27277,-99.20056],[34.32707,-99.19659],[34.40263,-99.25792],[34.43749,-99.34167],[34.41999,-99.39111],[34.38027,-99.44388],[34.37874,-99.62986],[34.39875,-99.68611],[34.45333,-99.75196],[34.50666,-99.81027],[34.55694,-99.87264],[34.57527,-99.93069],[34.57694,-99.99596],[34.88276,-100.00111],[36.49972,
-100.00029],[36.5,-103.00029]]},cached:{},config:{},models:{},collections:{},views:{},helpers:{add_ajax_loader_template:function(a){a.append(STANFORD.MAPPING_TEXTS.config.templates.ajax_loader)},del_ajax_loader_template:function(a){a.children(".ajax-container").remove()},normalize:function(a){return a.replace(/ /g,"_")},make_bar_graph:function(a,b,c,d){var e=padding_size=20;d-=padding_size;var f=e*a.length,e=d-150,i=d3.scale.linear().domain([0,d3.max(a)]).range([0,e]),h=d3.scale.ordinal().domain(d3.range(a.length)).rangeBands([0,
f],0.2),c=d3.select(c).append("svg:svg").attr("class","chart").attr("width",d+90).attr("height",f).append("svg:g").attr("transform","translate(90,0)").selectAll("g.bar").data(a).enter().append("svg:g").attr("class","bar").attr("transform",function(a,b){return"translate(0,"+h(b)+")"});c.append("svg:rect").attr("fill","#F4765E").attr("width",i).attr("height",h.rangeBand());c.append("svg:text").attr("x",e+90-26).attr("y",h.rangeBand()/2).attr("dx",-1).attr("dy",".35em").attr("fill","#333").attr("text-anchor",
"end").text(function(b,c){return a[c].toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")});c.append("svg:text").attr("x",-3).attr("y",h.rangeBand()/2).attr("dx",-6).attr("dy",".35em").attr("fill","#333").attr("text-anchor","end").text(function(a,c){return b[c]})},make_tag_cloud:function(a,b){var c=b[0],d=_.map(b,function(a){return Math.round(a/c*100)}),e=_.map(d,function(a,b){return d[b]<=14?"tag-1":d[b]<=25?"tag-2":d[b]<=50?"tag-3":d[b]<=75?"tag-4":"tag-5"});return function(a){var b,c,d=a.length;if(d)for(;--d;)c=
Math.floor(Math.random()*(d+1)),b=a[c],a[c]=a[d],a[d]=b;return a}(_.map(a,function(a,b){return{tag:a,percentage:d[b],klass:e[b]}}))},update_slider:function(a,b){var c=STANFORD.MAPPING_TEXTS.cached,d,e;c.select_aa.find("option:selected").removeAttr("selected");c.select_bb.find("option:selected").removeAttr("selected");c.select_aa.find('option[value="'+a+'"]').attr("selected","selected");c.select_bb.find('option[value="'+b+'"]').attr("selected","selected");d=c.select_aa.get(0).selectedIndex;e=c.select_bb.get(0).selectedIndex;
c.jqui.jqui_slider.slider("values",0,d);c.jqui.jqui_slider.slider("values",1,e);$("#handle_valueAA").attr("aria-valuetext",a).attr("aria-valuenow",d).find(".ui-slider-tooltip .ttContent").text(a);$("#handle_valueBB").attr("aria-valuetext",b).attr("aria-valuenow",e).find(".ui-slider-tooltip .ttContent").text(b)},fetch_publications:function(a){var b=STANFORD.MAPPING_TEXTS.helpers;STANFORD.MAPPING_TEXTS.cached.pubs.fetch({data:a,success:function(){console.log("**** pubs fetched success");b.del_ajax_loader_template($("#pub-view").find(".bd"));
b.del_ajax_loader_template($("#map-view"))}});b.add_ajax_loader_template($("#pub-view").find(".box"));b.add_ajax_loader_template($("#map-view"))},fetch_wcc:function(a){var b=STANFORD.MAPPING_TEXTS.helpers;STANFORD.MAPPING_TEXTS.cached.wcc_collection.fetch({data:a,success:function(){console.log("**** wcc fetched success");b.del_ajax_loader_template($("#wcc-view").find(".inner"))}});b.add_ajax_loader_template($("#wcc-view").find(".inner"))},fetch_ner:function(a){var b=STANFORD.MAPPING_TEXTS.helpers;
STANFORD.MAPPING_TEXTS.cached.ner_collection.fetch({data:a,success:function(){console.log("**** ner fetched success");b.del_ajax_loader_template($("#ner-view").find(".inner"))}});b.add_ajax_loader_template($("#ner-view").find(".inner"))},fetch_topics:function(a){var b=STANFORD.MAPPING_TEXTS.helpers;STANFORD.MAPPING_TEXTS.cached.topics.fetch({data:a,success:function(){console.log("**** topics fetched success");b.del_ajax_loader_template($("#topic-view").find(".inner"))}});b.add_ajax_loader_template($("#topic-view").find(".inner"))},
get_fetch_data_arg:function(a){return{fetch_publications:function(){return{y1:a.selected_year_range.y1,y2:a.selected_year_range.y2}},fetch_topics:function(){var b;return a.epochs.epoch_is_not_selected()?{}:(b=a.pubs.get_if_all_cities_pubs_selected(),b===!0?{v:a.epochs.epoch_norm()}:(b=a.pubs.get_if_city_and_all_its_pubs_selected(),b!==!1?{v:a.epochs.epoch_norm(),postfix:b}:(b=a.pubs.get_if_city_and_one_pub_selected(),b!==!1?{v:a.epochs.epoch_norm(),postfix:b}:{})))},fetch_wcc:function(){return{y1:a.selected_year_range.y1,
y2:a.selected_year_range.y2,pubs:a.pubs.parse_pubs()}},fetch_ner:function(){return{y1:a.selected_year_range.y1,y2:a.selected_year_range.y2,pubs:a.pubs.parse_pubs()}}}},invokePlugins:function(a){_.forEach(a.plugins,function(b){if(b==="tabs")$(a.parentEl).find(".tabs").tabs(".tab-content > .tab-pane",{effect:"fade"});else if(b==="tooltip")$(a.parentEl).find("[title]").tooltip({effect:"fade",predelay:500,offset:[-10,0]});else if(b==="modal")$(a.parentEl).find("a[data-modal-box]").modal();else if(b===
"clipboard")$(a.parentEl).find('[data-copy-clipboard="button"]').zclip({path:"static/flash/ZeroClipboard.swf",copy:$(a.parentEl).find('[data-copy-clipboard="text"]').text()});else throw"oops, plugin : "+b+" does not exist";})},toggleRows:function(){var a=$('[data-toggle="height"]'),b=$("<div><i></i></div>"),c=b.find("i");a.after(b);b.css("overflow","hidden");b.find("i").addClass("icon-arrow up push");c.on("click",function(){$(a).animate({height:"toggle"},"fast");c.toggleClass(function(){return $(this).find(a).filter(":hidden")?
"down":"up"})})}},objects:{},traits:{fetch_data:function(){var a=STANFORD.MAPPING_TEXTS.helpers,b=a.get_fetch_data_arg(STANFORD.MAPPING_TEXTS.cached);_.each(this.fetch_funs,function(c){var d=b[c]();a[c](d)});console.log("fetch_data() called")}}};(function(){STANFORD.MAPPING_TEXTS.models.wcc=Backbone.Model.extend({initialize:function(){}})})();(function(){STANFORD.MAPPING_TEXTS.models.ner=Backbone.Model.extend({initialize:function(){}})})();
(function(){STANFORD.MAPPING_TEXTS.models.city=Backbone.Model.extend({defaults:{display:!1},initialize:function(){console.log("city initialized");this.set({pubs:new STANFORD.MAPPING_TEXTS.collections.publications(this.get("pubs"))});this.on("change:display",this.add_remove_city_to_pub_view);this.on("change:display",function(a,b,c){b={fetch_funs:["fetch_wcc","fetch_ner","fetch_topics"]};c.mode==="BULK_SELECT_OPT"&&c.fetch&&this.fetch_data.call(b);c.mode==="USER_CLICKED_OPT"&&c.fetch&&this.fetch_data.call(b);
console.log("FETCH city",a.get("city"),"Mode:",c.mode,"Fetch:",c.fetch)})},all_pubs_selected:function(){return this.get("pubs").all(function(a){return a.get("checked")})},get_if_one_pub_selected:function(){var a=this.get("pubs").filter(function(a){return a.get("checked")});return a.length===1?a=a[0]:!1},add_remove_city_to_pub_view:function(a,b){a.previous("display")===!1&&b===!0&&(console.log("add city to pub-view: "+a.get("city")),a.add_new_city());a.previous("display")===!0&&b===!1&&(console.log("remove city from pub-view: "+
a.get("city")),a.remove_city())},add_new_city:function(){var a=new STANFORD.MAPPING_TEXTS.views.city_view({model:this});$("#pub-view").find(".spiffy-scrollbar").children("i").addClass("hidden").end().append(a.render().el).find('[data-checkbox="check-all"]').each(function(a){$(this).attr("id","check-all-"+(a+1)).add().next("label").attr("for","check-all-"+(a+1));$(this).setupCheckboxAll({closestWrapper:$(this).closest('[data-pub="label"]').next('[data-pub="listings"]')})})},remove_city:function(){var a=
STANFORD.MAPPING_TEXTS.helpers.normalize(this.get("city"));$("#pub-view").find(".spiffy-scrollbar").children().filter("#"+a).remove();a=$("#pub-view").find(".spiffy-scrollbar").children();a.size()===1&&a.eq(0).removeClass("hidden")}});_.extend(STANFORD.MAPPING_TEXTS.models.city.prototype,{fetch_data:STANFORD.MAPPING_TEXTS.traits.fetch_data})})();
(function(){STANFORD.MAPPING_TEXTS.models.publication=Backbone.Model.extend({defaults:{checked:!0},initialize:function(){console.log("publication model initialized");this.on("change:checked",this.info);this.on("change:checked",function(a,b,c){b={fetch_funs:["fetch_wcc","fetch_ner","fetch_topics"]};c.mode==="BULK_SELECT_OPT"&&c.fetch&&this.fetch_data.call(b);c.mode==="USER_CLICKED_OPT"&&c.fetch&&this.fetch_data.call(b);console.log("FETCH publication",a.get("pub"),"Mode:",c.mode,"Fetch:",c.fetch)})},
info:function(a,b){console.log("pubname: "+a.get("pub"));console.log("old checked value: "+a.previous("checked"));console.log("new checked value: "+b)}});_.extend(STANFORD.MAPPING_TEXTS.models.publication.prototype,{fetch_data:STANFORD.MAPPING_TEXTS.traits.fetch_data})})();
(function(){STANFORD.MAPPING_TEXTS.models.epoch=Backbone.Model.extend({defaults:{selected:!1},initialize:function(){console.log("epoch model initialized");this.on("change:selected",this.update_epoch_el)},update_epoch_el:function(a,b){b?$("#time-select-view .era-nav").find('a[data-epoch="'+a.get("years")+'"]').addClass("active"):$("#time-select-view .era-nav").find('a[data-epoch="'+a.get("years")+'"]').removeClass("active")}})})();
(function(){STANFORD.MAPPING_TEXTS.collections.wcc=Backbone.Collection.extend({model:STANFORD.MAPPING_TEXTS.models.wcc,initialize:function(){console.log("wcc collection initialized...")},url:"/wcc",parse:function(a){return a.wcc}})})();(function(){STANFORD.MAPPING_TEXTS.collections.ner=Backbone.Collection.extend({model:STANFORD.MAPPING_TEXTS.models.ner,initialize:function(){console.log("ner collection initialized...")},url:"/ner",parse:function(a){return a.ner}})})();
(function(){STANFORD.MAPPING_TEXTS.collections.pubs=Backbone.Collection.extend({model:STANFORD.MAPPING_TEXTS.models.city,initialize:function(){console.log("pubs collection initialized...")},url:"/pub",parse:function(a){return a.pubs},comparator:function(a){return a.get("city")},set_pubseq:function(a,b,c){this.forEach(function(d){var e=d.get("pubs").find(function(b){return b.get("pubseq")===a});e?e.set({checked:b},c):console.log("Not found for city "+d.get("city"))})},parse_pubs:function(){var a=STANFORD.MAPPING_TEXTS.helpers,
b=[];this.forEach(function(c){c.get("display")&&c.get("pubs").forEach(function(d){var e;d.get("checked")&&(e=a.normalize(c.get("city")),d=a.normalize(d.get("pub")),b.push(e+":"+d))})});return b},get_if_all_cities_pubs_selected:function(){return this.all(function(a){return a.get("display")&&a.all_pubs_selected()})},get_if_city_and_all_its_pubs_selected:function(){var a=STANFORD.MAPPING_TEXTS.helpers,b=this.filter(function(a){return a.get("display")});return b.length===1?(b=b[0],b.all_pubs_selected()===
!0?a.normalize(b.get("city")):!1):!1},get_if_city_and_one_pub_selected:function(){var a=STANFORD.MAPPING_TEXTS.helpers,b=this.filter(function(a){return a.get("display")});return b.length===1?(b=b[0],pub_selected=b.get_if_one_pub_selected(),pub_selected!==!1?a.normalize(b.get("city"))+":"+a.normalize(pub_selected.get("pub")):!1):!1}})})();
(function(){STANFORD.MAPPING_TEXTS.collections.publications=Backbone.Collection.extend({model:STANFORD.MAPPING_TEXTS.models.publication,initialize:function(){console.log("publication collection initialized...")},comparator:function(a){return a.get("pub")}})})();
(function(){STANFORD.MAPPING_TEXTS.collections.epochs=Backbone.Collection.extend({model:STANFORD.MAPPING_TEXTS.models.epoch,initialize:function(){console.log("epoch collection initialized...")},epoch_is_not_selected:function(){return typeof this.get_selected()==="undefined"},epoch_norm:function(){var a=this.get_selected();if(typeof a!=="undefined")return a.get("years").replace("-",":");throw"Epoch should be selected at this point.";},get_selected:function(){return this.find(function(a){return a.get("selected")})},
unselect:function(){var a=this.get_selected();typeof a!=="undefined"&&a.set({selected:!1})},set_selected:function(a){var b,c,d;a.epoch?b=this.find(function(b){return b.get("years")===a.epoch}):a.y1&&a.y2&&(c=parseInt(a.y1,10),d=parseInt(a.y2,10),b=this.find(function(a){return c===a.get("begin")&&d===a.get("end")}));this.unselect();typeof b!=="undefined"&&b.set({selected:!0})}})})();
(function(){STANFORD.MAPPING_TEXTS.collections.topics=Backbone.Collection.extend({initialize:function(){console.log("topics collection initialized")},url:"/topic",parse:function(a){return a.topics}})})();
$(function(){STANFORD.MAPPING_TEXTS.views.app=Backbone.View.extend({el:"body",initialize:function(){var a=STANFORD.MAPPING_TEXTS.cached;console.log("app view created");$(window).resize(function(){console.log("a resize happened on body")});a.pubs=new STANFORD.MAPPING_TEXTS.collections.pubs;a.pubs.on("reset",this.render_map,this);a.pubs.on("reset",function(){google.maps.event.trigger(a.controlUI,"click")});a.wcc_collection=new STANFORD.MAPPING_TEXTS.collections.wcc;a.wcc_collection.on("reset",this.render_wcc,
this);a.ner_collection=new STANFORD.MAPPING_TEXTS.collections.ner;a.ner_collection.on("reset",this.render_ner,this);a.topics=new STANFORD.MAPPING_TEXTS.collections.topics;a.topics.on("reset",this.render_topics,this)},render:function(){var a=STANFORD.MAPPING_TEXTS.cached,b=STANFORD.MAPPING_TEXTS.helpers,c=STANFORD.MAPPING_TEXTS.config,d=parseInt(c.start,10),c=parseInt(c.end,10);this.render_time();a.selected_year_range={y1:d,y2:c};a.epochs.set_selected({y:c});this.fetch_data.call({fetch_funs:["fetch_publications"]});
this.render_wcc();this.render_ner();this.render_topics();b.invokePlugins({parentEl:"#app-ds-view",plugins:["modal"]});b.toggleRows()},render_time:function(){var a=STANFORD.MAPPING_TEXTS.cached,b=STANFORD.MAPPING_TEXTS.helpers,c=new STANFORD.MAPPING_TEXTS.views.time_select_view({collection:a.epochs}),d=$(this.el).find("#time-select-view");d.replaceWith(c.render().el);d=$(this.el).find("#time-select-view");a.jqui=d.find("select#valueAA, select#valueBB").selectToUISlider({labels:10});a.select_aa=d.find("select#valueAA");
a.select_bb=d.find("select#valueBB");b.invokePlugins({parentEl:"#time-select-view",plugins:["tooltip"]});a.select_aa.change(function(){console.log("change happened!!!!!!!")})},render_map:function(){this.render_pub_view();var a=new STANFORD.MAPPING_TEXTS.views.map_view,b=STANFORD.MAPPING_TEXTS.cached,c=STANFORD.MAPPING_TEXTS.helpers,d={mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.ROADMAP,"Dark"]},navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},
center:STANFORD.MAPPING_TEXTS.geocoding.texas,zoom:6,mapTypeId:google.maps.MapTypeId.TERRAIN},e;$(this.el).find("#map-view").replaceWith(a.render().el);e=new google.maps.Map($(this.el).find("#map-view").get(0),d);e.mapTypes.set("Dark",new google.maps.StyledMapType([{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0}]},{featureType:"administrative",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{visibility:"off"}]}],{name:"Dark"}));a=
document.createElement("DIV");new function(a){a.style.padding="5px";var c=document.createElement("DIV");c.style.backgroundColor="white";c.style.borderStyle="solid";c.style.borderWidth="1px";c.style.cursor="pointer";c.style.textAlign="center";a.appendChild(c);a=document.createElement("DIV");a.style.fontFamily="Arial,sans-serif";a.style.fontSize="12px";a.style.paddingLeft="4px";a.style.paddingRight="4px";a.innerHTML="<b>Select All</b>";c.appendChild(a);b.controlUI=c;google.maps.event.addDomListener(c,
"click",function(){var a=b.pubs.size(),c;f.text()==="Unselect All"?(console.log("===SET from unselected to selected==="),f.html("Select All"),c=function(b,c){var d=b.get("circle_overlay");b.set({display:!1},{mode:"BULK_SELECT_OPT",fetch:a===c+1});d.setOptions({strokeColor:"#FF0000"})}):(console.log("===SET from selected to unselected==="),f.html("Unselect All"),c=function(b,c){var d=b.get("circle_overlay");b.set({display:!0},{mode:"BULK_SELECT_OPT",fetch:a===c+1});d.setOptions({strokeColor:"#CCFF33"})});
b.pubs.forEach(c)})}(a,e);var f=$(a).find("b");a.index=1;e.controls[google.maps.ControlPosition.TOP_LEFT].push(a);a=document.createElement("DIV");new function(a){a.style.padding="10px";var b=document.createElement("DIV");b.style.width="130px";b.style.padding="10px";b.style.backgroundColor="white";b.style.borderWidth="1px";b.style.borderStyle="solid";b.style.borderColor="#555";b.style.opacity="0.8";b.style.boxShadow="0 0 3px rgba(0,0,0,0.5) inset";a.appendChild(b);a=document.createElement("DIV");a.style.fontFamily=
"Arial,sans-serif";a.style.fontSize="12px";a.style.paddingLeft="4px";a.style.paddingRight="4px";a.innerHTML="<h6>Legend</h6><p>Circle size corresponds to the number of publications per city for the selected time period.";b.appendChild(a)}(a);a.index=1;e.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(a);(function(a){for(var b=[],c=STANFORD.MAPPING_TEXTS.geocoding.contour,d=0;d<c.length;d++)b.push(new google.maps.LatLng(c[d][0],c[d][1]));(new google.maps.Polygon({paths:b,strokeColor:"#666666",
strokeOpacity:0.6,strokeWeight:4,fillColor:"#000000",fillOpacity:0})).setMap(a)})(e);b.pubs.forEach(function(a){var b=c.normalize(a.get("city")),d=STANFORD.MAPPING_TEXTS.geocoding[b],b=a.get("pubs").length,f=2E4+b*5E3,d={clickable:!0,strokeColor:"#FF0000",strokeOpacity:0.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:0.35,map:e,center:d,radius:f,zIndex:1E6-f},b="<h6>"+a.get("city")+"</h6><p>Publications: "+b,j=new google.maps.InfoWindow({content:b}),g=new google.maps.Circle(d);a.set({circle_overlay:g});
google.maps.event.addListener(g,"mouseover",function(){j.setPosition(g.getCenter());j.open(e)});google.maps.event.addListener(g,"mouseout",function(){j.close()});google.maps.event.addListener(g,"click",function(){var b={fetch:!0,mode:"USER_CLICKED_OPT"};a.get("display")===!0?(console.log(a.get("city"),"circle clicked, *DISPLAYED*"),a.set({display:!1},b),g.setOptions({strokeColor:"#FF0000"})):(console.log(a.get("city"),"circle clicked, *NOT DISPLAYED*"),a.set({display:!0},b),g.setOptions({strokeColor:"#CCFF33"}))})})},
render_pub_view:function(){var a=new STANFORD.MAPPING_TEXTS.views.pub_view;$(this.el).find("#pub-view").html(a.render().el)},render_wcc:function(){var a=STANFORD.MAPPING_TEXTS.helpers,b=STANFORD.MAPPING_TEXTS.cached.wcc_collection,c=data=b.pluck("count"),d=labels=b.pluck("word"),e=$(this.el).find("#wcc-view .box").width(),d=a.make_tag_cloud(d,c),b=new STANFORD.MAPPING_TEXTS.views.wcc_view({collection:b,tags:d});$(this.el).find("#wcc-view").html(b.render().el);a.invokePlugins({parentEl:"#wcc-view",
plugins:["tabs","tooltip","modal","clipboard"]});a.make_bar_graph(data,labels,"#wcc-view .d3-chart",e)},render_ner:function(){var a=STANFORD.MAPPING_TEXTS.helpers,b=STANFORD.MAPPING_TEXTS.cached.ner_collection,c=data=b.pluck("count"),d=labels=b.pluck("entity"),e=$(this.el).find("#ner-view .box").width(),d=a.make_tag_cloud(d,c),b=new STANFORD.MAPPING_TEXTS.views.ner_view({collection:b,tags:d});$(this.el).find("#ner-view").html(b.render().el);a.invokePlugins({parentEl:"#ner-view",plugins:["tabs","tooltip",
"modal","clipboard"]});a.make_bar_graph(data,labels,"#ner-view .d3-chart",e)},render_topics:function(){var a=STANFORD.MAPPING_TEXTS.helpers,b=new STANFORD.MAPPING_TEXTS.views.topic_view({collection:STANFORD.MAPPING_TEXTS.cached.topics});$(this.el).find("#topic-view").html(b.render().el);a.invokePlugins({parentEl:"#topic-view",plugins:["modal","tooltip","clipboard"]})}});_.extend(STANFORD.MAPPING_TEXTS.views.app.prototype,{fetch_data:STANFORD.MAPPING_TEXTS.traits.fetch_data})});
$(function(){STANFORD.MAPPING_TEXTS.views.wcc_view=Backbone.View.extend({tagName:"div",className:"widget basic module",events:{},initialize:function(){console.log("wcc_view view created")},render:function(){var a=STANFORD.MAPPING_TEXTS.cached,b=STANFORD.MAPPING_TEXTS.config.templates.wcc_view,a={wcc:this.collection.toJSON(),tags:this.options.tags,y1:a.selected_year_range.y1,y2:a.selected_year_range.y2},b=Mustache.to_html(b,a);$(this.el).html(b);return this}})});
$(function(){STANFORD.MAPPING_TEXTS.views.ner_view=Backbone.View.extend({tagName:"div",className:"widget basic module",events:{},initialize:function(){console.log("ner_view view created")},render:function(){var a=STANFORD.MAPPING_TEXTS.cached,b=STANFORD.MAPPING_TEXTS.config.templates.ner_view,a={ner:this.collection.toJSON(),tags:this.options.tags,y1:a.selected_year_range.y1,y2:a.selected_year_range.y2},b=Mustache.to_html(b,a);$(this.el).html(b);return this}})});
$(function(){STANFORD.MAPPING_TEXTS.views.topic_view=Backbone.View.extend({tagName:"div",className:"widget basic module",events:{"click #topic-view [data-click]":"showTopicKeys","click .topic-key-list [data-dismiss]":"hideTopicKeys"},initialize:function(){console.log("topic_view view created")},render:function(){var a=STANFORD.MAPPING_TEXTS.config.templates.topic_view,b=STANFORD.MAPPING_TEXTS.cached.epochs.get_selected(),b={epoch:b?b.get("years"):"no era selected",topics:this.collection.toJSON()},
a=Mustache.to_html(a,b);$(this.el).html(a);return this},showTopicKeys:function(a){$(a.target).attr("data-click","true").closest("li").siblings("li").find("[data-click]").attr("data-click","")},hideTopicKeys:function(a){$(a.target).closest("div").attr("data-click","false")}})});
$(function(){STANFORD.MAPPING_TEXTS.views.map_view=Backbone.View.extend({tagName:"section",id:"map-view",className:"span-66pct widget basic map-view",events:{},initialize:function(){console.log("map_view view created")},render:function(){var a=Mustache.to_html(STANFORD.MAPPING_TEXTS.config.templates.map_view,{});$(this.el).html(a);return this}})});
$(function(){STANFORD.MAPPING_TEXTS.views.pub_view=Backbone.View.extend({tagName:"div",className:"widget basic tool",events:{'click label[data-checkbox="check-all"]':"city_label_clicked",'change [data-checkbox="check-all"]':"city_cb_change",'change [data-checkbox="pub-check"]':"pub_cb_change",'click [data-details="details"] [data-details="summary"]':"disclosureWidget"},initialize:function(){console.log("pub_view view created")},render:function(){var a=STANFORD.MAPPING_TEXTS.cached,a=Mustache.to_html(STANFORD.MAPPING_TEXTS.config.templates.pub_view,
{y1:a.selected_year_range.y1,y2:a.selected_year_range.y2});$(this.el).html(a);return this},city_label_clicked:function(){},city_cb_change:function(a){var b=this,c=STANFORD.MAPPING_TEXTS.cached,d={mode:"BULK_SELECT_OPT",fetch:!1},e={mode:"BULK_SELECT_OPT",fetch:!0},f=$(a.target),a=f.is(":checked"),f=f.parent().next("ul").find("li input"),i=f.size(),h=function(a){var f=b.get_pubseq($(this));$(this).attr("checked","checked");a===i-1?c.pubs.set_pubseq(f,!0,e):c.pubs.set_pubseq(f,!0,d)},k=function(a){var f=
b.get_pubseq($(this));$(this).removeAttr("checked");a===i-1?c.pubs.set_pubseq(f,!1,e):c.pubs.set_pubseq(f,!1,d)};console.log("city cb all change.");f.each(a?h:k)},pub_cb_change:function(a){var b=STANFORD.MAPPING_TEXTS.cached,c=$(a.target),a=c.is(":checked"),c=this.get_pubseq(c);b.pubs.set_pubseq(c,a,{mode:"USER_CLICKED_OPT",fetch:!0})},disclosureWidget:function(a){$(a.target).next('[data-details="content"]').animate({height:"toggle"},"fast").closest('[data-details="details"]').toggleClass("open")},
get_pubseq:function(a){return a.attr("id").split("-")[1]}})});
$(function(){STANFORD.MAPPING_TEXTS.views.time_select_view=Backbone.View.extend({tagName:"section",id:"time-select-view",className:"span-full",events:{slidestop:"slider_updated","click .epoch a":"epoch_updated"},initialize:function(){console.log("time_select_view view created")},render:function(){var a=STANFORD.MAPPING_TEXTS.config.templates.time_select_view,b=STANFORD.MAPPING_TEXTS.config,c={epochs:this.collection.toJSON(),_1800s:_.range(b.start,1900),_1900s:_.range(1900,2E3),_2000s:_.range(2E3,
b.end+1)},a=Mustache.to_html(a,c);$(this.el).html(a).find('#valueAA option[value="'+b.start+'"]').attr("selected","selected").end().find('#valueBB option[value="'+b.end+'"]').attr("selected","selected");return this},slider_updated:function(){var a=STANFORD.MAPPING_TEXTS.cached,b=a.select_aa.val(),c=a.select_bb.val();a.selected_year_range={y1:b,y2:c};a.epochs.set_selected({y1:b,y2:c});this.fetch_data.call({fetch_funs:["fetch_publications"]})},epoch_updated:function(a){a.preventDefault();this.process_epoch($(a.target).attr("data-epoch"))},
process_epoch:function(a){var b=STANFORD.MAPPING_TEXTS.cached,c=STANFORD.MAPPING_TEXTS.helpers,d=a.split("-"),e=d[0],d=d[1];c.update_slider(e,d);b.selected_year_range={y1:e,y2:d};b.epochs.set_selected({epoch:a});this.fetch_data.call({fetch_funs:["fetch_publications"]})}});_.extend(STANFORD.MAPPING_TEXTS.views.time_select_view.prototype,{fetch_data:STANFORD.MAPPING_TEXTS.traits.fetch_data})});
$(function(){STANFORD.MAPPING_TEXTS.views.city_view=Backbone.View.extend({tagName:"div",className:"open",initialize:function(){},render:function(){var a=STANFORD.MAPPING_TEXTS.config.templates.city_view,b=STANFORD.MAPPING_TEXTS.helpers,c={city:this.model.get("city"),pubs:this.model.get("pubs").toJSON()},a=Mustache.to_html(a,c),b=b.normalize(this.model.get("city"));$(this.el).html(a).attr("id",b).attr("data-details","details");return this}})});
